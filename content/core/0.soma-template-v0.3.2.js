/*!
soma-template - v0.3.2 - 2015-03-03
http://soundstep.github.com/soma-template/
http://www.soundstep.com
MIT licence 2015
*/
!function(e){"use strict";function t(e){return"[object Array]"===Object.prototype.toString.apply(e)}function n(e){return"object"==typeof e}function i(e){return"string"==typeof e}function r(e){return e?e.nodeType>0:!1}function a(e){return e&&e.nodeType&&3===e.nodeType}function s(e){return e&&"function"==typeof e}function o(e){return null!==e&&void 0!==e}function l(e){return o(e)?"true"===e||"1"===e||e===!0||1===e?!0:"false"===e||"0"===e||e===!1||0===e||i(e)&&V(e)?!1:!!e:!1}function u(e){return e&&s(e.toString)&&"[object Expression]"===e.toString()}function h(e){return i(e)?!!e.match(ye.func):!1}function p(e){return e&&e.parent&&Te.get(e.element)}function c(e){return e.replace(ye.escape,"\\$&")}function d(e,t){var n=pe.start().replace(/\\/g,""),i="",r=t?e:n;r.length>1&&(i="|\\"+r.substr(0,1)+"(?!\\"+r.substr(1,1)+")[^"+r.substr(0,1)+"]*"),ye.sequence=new RegExp(pe.start()+".+?"+pe.end()+"|[^"+pe.start()+"]+"+i,"g"),ye.token=new RegExp(pe.start()+".*?"+pe.end(),"g"),ye.expression=new RegExp(pe.start()+"|"+pe.end(),"gm")}function f(e){return e.replace(ye.trim,"")}function v(e){return ye.string.test(e)?e.substr(1,e.length-2):e}function m(e){return""===e[0]&&e.shift(),""===e[e.length-1]&&e.pop(),e}function g(e){return e.replace(ye.expression,"")}function b(e){return e.replace(ye.depth,"")}function y(e,t){e.parentNode&&e.parentNode.insertBefore(t,e)}function E(e,t){e.parentNode&&e.parentNode.insertBefore(t,e.nextSibling)}function w(e,t){var n;(n="object"==typeof document&&document.documentElement.classList?function(e,t){e.classList.remove(t)}:function(e,t){if(!e||!e.className)return!1;var n=new RegExp("(^|\\s)"+t+"(\\s|$)","g");e.className=e.className.replace(n,"$2")})(e,t)}function N(e){function t(){return++r+e}function n(n){if(n){if("object"!=typeof n)return n;var i;try{i=n[e]?n[e]:n[e]=t()}catch(r){}return i}}var i={},r=0;this.remove=function(e){delete i[n(e)]},this.get=function(e){return i[n(e)]},this.put=function(e,t){i[n(e)]=t},this.has=function(e){return"undefined"!=typeof i[n(e)]},this.getData=function(){return i},this.dispose=function(){for(var e in i)i.hasOwnProperty(e)&&delete i[e];this.length=0}}function R(e,t){var n=e.match(ye.repeat);if(n){var i=n[2],r=new ke(i);return r.getValue(t)}}function x(e,t,n){var i=e.match(ye.repeat);if(i){var r=i[1];t[r]=n}}function S(e,t){var n=e.node||e.attribute.node,i=n.template.watchers,r=n.element;if(!i)return t;var l=i.get(r);!l&&a(n.element)&&n.parent&&(l=i.get(n.parent.element));var u=l?l:i.get(e.pattern);if(s(u)){var h=u(e.value,t,e.pattern,n.scope,n,e.attribute);if(o(h))return h}return t}function k(e,t){for(var n=C(t),i=e;n>0;)i=i._parent?i._parent:i,n--;return i}function T(e,t,n){var i=new ke(t);return $(e,i.pattern,i.path,i.params,void 0,void 0,void 0,n)}function $(e,t,n,i,r,a,l,u){if(t===de.element)return u[de.element];if(t===de.parentElement)return u[de.parentElement];if(t===de.attribute)return u[de.attribute];if(t===de.scope)return u[de.scope];if(ye.string.test(t))return v(t);if(!isNaN(t))return+t;var h=[];if(!l&&i)for(var p=0,c=i.length;c>p;p++)h.push(T(e,i[p],u));else h=l;if(a)return h;var d=k(e,t);if(t=t.replace(/..\//g,""),n=n.replace(/..\//g,""),d){var f=d,m=n.split(/\.|\[|\]/g);if(m.length>0)for(var g=0,b=m.length;b>g;g++)if(""!==m[g]&&(f=f[m[g]]),!o(f))return d._parent?$(d._parent,t,n,i,r,a,h):void 0;return s(f)?r?f:f.apply(null,h):f}}function _(e){var t=e.split("(")[0];return t=b(t)}function A(e){return m(e.split(ye.params))}function C(e){var t=e.split("(")[0],n=t.match(ye.depth);return n?n.length:0}function L(e,t,n){var i;return e.attributes=e.attributes||[],t===he.attributes.skip&&(e.skip=l(n)),t===he.attributes.html&&(e.html=l(n)),t!==he.attributes.repeat||e.isRepeaterDescendant||(e.repeater=n),(V(t+":"+n)||t===he.attributes.repeat||t===he.attributes.skip||t===he.attributes.html||t===he.attributes.show||t===he.attributes.hide||t===he.attributes.href||t===he.attributes["class"]||t===he.attributes.checked||t===he.attributes.disabled||t===he.attributes.multiple||t===he.attributes.readonly||t===he.attributes.selected||-1!==n.indexOf(he.attributes.cloak))&&(i=new xe(t,n,e),e.attributes.push(i)),fe[t]&&(i=new xe(t,n,e),e.attributes.push(i)),i}function P(e,t){var n=new Re(e,t);n.previousSibling=e.previousSibling,n.nextSibling=e.nextSibling;for(var i,r=[],a=e.attributes,s=0,o=a&&a.length;o>s;s++)if(i=a[s],i.specified||"value"===i.name){var l=L(n,i.name,i.value);fe[i.name]&&fe[i.name]&&!n.isRepeaterChild&&r.push({name:fe[i.name],value:i.value,attr:l})}for(var u=0,h=r.length;h>u;u++)n.addEvent(r[u].name,r[u].value,r[u].attr);return n}function V(e){var t=e.match(ye.token);return t&&t.length>0}function O(e){return ye.content.test(e)}function D(e){if(e){var t=e.nodeType;return e&&t?8===t?!1:3!==t||O(e.nodeValue)||V(e.nodeValue)?!0:!1:!1}}function q(e,t,n,i){if(D(t)){var r;if(i?(r=i,r.parent=n):r=P(t,n?n.scope:new Ne(ue)._createChild()),n&&(n.repeater||n.isRepeaterChild)&&(r.isRepeaterChild=!0),r.template=e,!r.skip){for(var a=t.firstChild;a;){var s=q(e,a,r);s&&(s.parent=r,r.children.push(s)),a=a.nextSibling}return r}}}function M(e,t){H(e);for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}function H(e){for(var t in e)e.hasOwnProperty(t)&&"_"!==t.substr(0,1)&&(e[t]=null,delete e[t])}function j(e){if(!e.repeater&&e.children&&!p(e))for(var t=0,n=e.children.length;n>t;t++)e.children[t].update()}function I(e){if(e.children&&!p(e))for(var t=0,n=e.children.length;n>t;t++)e.children[t].render()}function B(e){var n,i=R(e.repeater,e.scope);if(t(i)){for(var r=0,a=i.length,s=e.childrenRepeater.length,o=a>s?a:s;o>r;r++)a>r?n=W(e,r,i[r],de.index,r,n):(e.parent.element.removeChild(e.childrenRepeater[r].element),e.childrenRepeater[r].dispose());e.childrenRepeater.length>i.length&&(e.childrenRepeater.length=i.length)}else{var l=-1;for(var u in i)i.hasOwnProperty(u)&&(l++,n=W(e,l,i[u],de.key,u,n));for(var h=l;l++<e.childrenRepeater.length-1;)e.parent.element.removeChild(e.childrenRepeater[l].element),e.childrenRepeater[l].dispose();e.childrenRepeater.length=h+1}e.element.parentNode&&e.element.parentNode.removeChild(e.element)}function F(e,t){if(D(t.element)){if(e.attributes)for(var n=0,i=e.attributes.length;i>n;n++){var r=e.attributes[n],a=L(t,r.name,r.value);fe[r.name]&&t.addEvent(fe[r.name],r.value,a)}for(var s=e.element.firstChild,o=t.element.firstChild;s&&o;){var l=e.getNode(s),u=new Re(o,t.scope);t.children.push(u),u.parent=t,u.template=t.template,u.isRepeaterChild=!0;var h=F(l,u);h&&(h.parent=u,h.template=u.template,u.children.push(h)),s=s.nextSibling,o=o.nextSibling}return u}}function G(e,t){var n=new Re(e,t.scope._createChild());return n.template=t.template,n.parent=t,n.isRepeaterChild=!0,n.isRepeaterDescendant=!0,F(t,n),n}function J(e,t,n){e?E(e,n):t.element.previousSibling?E(t.element.previousSibling,n):t.element.nextSibling?y(t.element.nextSibling,n):t.parent.element.appendChild(n)}function W(e,t,n,i,r,a){var s=e.childrenRepeater[t];if(s)return x(e.repeater,s.scope,n),s.scope[i]=r,s.update(),s.render(),s.element;var o=e.element.cloneNode(!0);J(a,e,o);var l=G(o,e);return e.childrenRepeater[t]=l,x(e.repeater,l.scope,n),l.scope[i]=r,l.update(),l.render(),o}function z(e,t,n){if(e.addEventListener)e.addEventListener(t,n,!1);else{n.$$guid||(n.$$guid=z.guid++),e.events||(e.events={});var i=e.events[t];i||(i=e.events[t]={},e["on"+t]&&(i[0]=e["on"+t])),i[n.$$guid]=n,e["on"+t]=function(e){var t=!0;e=e||X(((this.ownerDocument||this.document||this).parentWindow||window).event);var n=this.events[e.type];for(var i in n)n.hasOwnProperty(i)&&(this.$$handleEvent=n[i],this.$$handleEvent(e)===!1&&(t=!1));return t}}}function U(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.events&&e.events[t]&&delete e.events[t][n.$$guid]}function X(e){return e.preventDefault=X.preventDefault,e.stopPropagation=X.stopPropagation,e}function K(e,t,n){_e=void 0===n?Number.MAX_VALUE:n,Q(e,t,0,!0)}function Q(e,t,n,i){if(!r(e))throw new Error("Error in soma.template.parseEvents, only a DOM Element can be parsed.");if(i&&Y(e,t),0!==_e)for(var a=e.firstChild;a;)1===a.nodeType&&_e>n&&(Q(a,t,++n),Y(a,t)),a=a.nextSibling}function Y(e,t){for(var n,i,r,a=e.attributes,o=0,l=a&&a.length;l>o;o++)if(n=a[o],n.specified&&(i=n.name,r=n.value,fe[i])){var u=Z(t,r);u&&s(u)&&(z(e,fe[i],u),Ce.push({element:e,type:fe[i],handler:u}))}}function Z(e,t){var n=t.match(ye.func);if(n){var i=n[1];if(s(e[i]))return e[i]}}function ee(e){for(var t=Ce.length,n=0;--t>=n;){var i=Ce[t];(e===i.element||we(e,i.element))&&(U(i.element,i.type,i.handler),Ce.splice(t,1))}}function te(e,t,n){var i=ne(t);n(i,i.scope,i.element,i.node)}function ne(t,n){var a;if(i(t)){if(!r(n))throw new Error(e.template.errors.TEMPLATE_STRING_NO_ELEMENT);n.innerHTML=t,a=n}else{if(!r(t))throw new Error(e.template.errors.TEMPLATE_NO_PARAM);r(n)?(n.innerHTML=t.innerHTML,a=n):a=t}ie(a)&&(ie(a).dispose(),Te.remove(a));var s=new $e(a);return Te.put(a,s),s}function ie(e){return Te.get(e)}function re(){var e=Te.getData();for(var t in Te.getData())e.hasOwnProperty(t)&&Te.get(t).render()}function ae(e){if(null===e&&(le={},ue={}),o(e)&&n(e))for(var t in e)e.hasOwnProperty(t)&&(le[t]=ue[t]=e[t]);return le}e.template=e.template||{},e.template.version="0.3.0",e.template.errors={TEMPLATE_STRING_NO_ELEMENT:"Error in soma.template, a string template requirement a second parameter: an element target - soma.template.create('string', element)",TEMPLATE_NO_PARAM:"Error in soma.template, a template requires at least 1 parameter - soma.template.create(element)"};var se="{{",oe="}}",le={},ue={},he=e.template.settings=e.template.settings||{};he.autocreate=!0;var pe=he.tokens={start:function(e){return o(e)&&""!==e&&(se=c(e),d(e,!0)),se},end:function(e){return o(e)&&""!==e&&(oe=c(e),d(e,!1)),oe}},ce=he.attributes={skip:"data-skip",repeat:"data-repeat",src:"data-src",href:"data-href",show:"data-show",hide:"data-hide",cloak:"data-cloak",checked:"data-checked",disabled:"data-disabled",multiple:"data-multiple",readonly:"data-readonly",selected:"data-selected",template:"data-template",html:"data-html","class":"data-class"},de=he.vars={index:"$index",key:"$key",element:"$element",parentElement:"$parentElement",attribute:"$attribute",scope:"$scope"},fe=he.events={};he.eventsPrefix="data-";var ve="click dblclick mousedown mouseup mouseover mouseout mousemove mouseenter mouseleave keydown keyup focus blur change select selectstart scroll copy cut paste mousewheel keypress error contextmenu input textinput drag dragenter dragleave dragover dragend dragstart dragover drop load submit reset search resize beforepaste beforecut beforecopy";ve+=" touchstart touchend touchmove touchenter touchleave touchcancel gesturestart gesturechange gestureend";for(var me=ve.split(" "),ge=-1,be=me.length;++ge<be;)fe[he.eventsPrefix+me[ge]]=me[ge];var ye={sequence:null,token:null,expression:null,escape:/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,trim:/^[\s+]+|[\s+]+$/g,repeat:/(.*)\s+in\s+(.*)/,func:/(.*)\((.*)\)/,params:/,\s+|,|\s+,\s+/,quote:/\"|\'/g,content:/[^.|^\s]/gm,depth:/..\//g,string:/^(\"|\')(.*)(\"|\')$/},Ee=function(){if("object"==typeof document){for(var e=3,t=!1,n=document.createElement("div");!t;)n.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->",n.getElementsByTagName("i")[0]||(t=!0);return e>4?e:void 0}}(),we="object"!=typeof document?function(){}:document.documentElement.contains?function(e,t){var n=9===e.nodeType?e.documentElement:e,i=t&&t.parentNode;return e===i||!!(i&&1===i.nodeType&&n.contains&&n.contains(i))}:document.documentElement.compareDocumentPosition?function(e,t){return t&&!!(16&e.compareDocumentPosition(t))}:function(e,t){for(;t=t.parentNode;)if(t===e)return!0;return!1},Ne=function(e){function t(e){var t=n(e);return t._parent=i,i._children.push(t),t}function n(e){var n=e||{};return n._parent=null,n._children=[],n._createChild=function(){return i=n,t.apply(n,arguments)},n}var i;return n(e)},Re=function(e,t){this.element=e,this.scope=t,this.attributes=null,this.value=null,this.interpolation=null,this.invalidate=!1,this.skip=!1,this.repeater=null,this.isRepeaterDescendant=!1,this.isRepeaterChild=!1,this.parent=null,this.children=[],this.childrenRepeater=[],this.previousSibling=null,this.nextSibling=null,this.template=null,this.eventHandlers={},this.html=!1,a(this.element)&&(this.value=this.element.nodeValue,this.interpolation=new Se(this.value,this,void 0))};Re.prototype={toString:function(){return"[object Node]"},dispose:function(){this.clearEvents();var e,t;if(this.children)for(e=0,t=this.children.length;t>e;e++)this.children[e].dispose();if(this.childrenRepeater)for(e=0,t=this.childrenRepeater.length;t>e;e++)this.childrenRepeater[e].dispose();if(this.attributes)for(e=0,t=this.attributes.length;t>e;e++)this.attributes[e].dispose();this.interpolation&&this.interpolation.dispose(),this.element=null,this.scope=null,this.attributes=null,this.value=null,this.interpolation=null,this.repeater=null,this.parent=null,this.children=null,this.childrenRepeater=null,this.previousSibling=null,this.nextSibling=null,this.template=null,this.eventHandlers=null},getNode:function(e){var t;if(e===this.element)return this;if(this.childrenRepeater.length>0)for(var n=0,i=this.childrenRepeater.length;i>n;n++)if(t=this.childrenRepeater[n].getNode(e))return t;for(var r=0,a=this.children.length;a>r;r++)if(t=this.children[r].getNode(e))return t;return null},getAttribute:function(e){if(this.attributes)for(var t=0,n=this.attributes.length;n>t;t++){var i=this.attributes[t];if(i.interpolationName&&i.interpolationName.value===e)return i}},update:function(){if(!p(this)){if(o(this.interpolation)&&this.interpolation.update(),o(this.attributes))for(var e=0,t=this.attributes.length;t>e;e++)this.attributes[e].update();j(this)}},invalidateData:function(){if(!p(this)){this.invalidate=!0;var e,t;if(this.attributes)for(e=0,t=this.attributes.length;t>e;e++)this.attributes[e].invalidate=!0;for(e=0,t=this.childrenRepeater.length;t>e;e++)this.childrenRepeater[e].invalidateData();for(e=0,t=this.children.length;t>e;e++)this.children[e].invalidateData()}},addEvent:function(e,t,n){if(!this.repeater){this.eventHandlers[e]&&this.removeEvent(e);var i=this.scope,r=this,a=function(e){var a=new ke(t,r,n),s=a.getValue(i,!0),o=a.getValue(i,!1,!0);o.unshift(e),s&&s.apply(null,o)};this.eventHandlers[e]=a,z(this.element,e,a)}},removeEvent:function(e){U(this.element,e,this.eventHandlers[e]),this.eventHandlers[e]=null,delete this.eventHandlers[e]},clearEvents:function(){if(this.eventHandlers)for(var e in this.eventHandlers)this.eventHandlers.hasOwnProperty(e)&&this.removeEvent(e);if(this.children)for(var t=0,n=this.children.length;n>t;t++)this.children[t].clearEvents();if(this.childrenRepeater)for(var i=0,r=this.childrenRepeater.length;r>i;i++)this.childrenRepeater[i].clearEvents()},render:function(){if(!p(this)){if(this.invalidate&&(this.invalidate=!1,a(this.element)&&(this.parent&&this.parent.html?this.value=this.parent.element.innerHTML=this.interpolation.render():this.value=this.element.nodeValue=this.interpolation.render())),this.attributes)for(var e=0,t=this.attributes.length;t>e;e++)this.attributes[e].render();this.repeater?B(this):I(this)}}};var xe=function(e,t,n){this.name=e,this.value=t,this.node=n,this.interpolationName=new Se(this.name,null,this),this.interpolationValue=new Se(this.value,null,this),this.invalidate=!1};xe.prototype={toString:function(){return"[object Attribute]"},dispose:function(){this.interpolationName&&this.interpolationName.dispose(),this.interpolationValue&&this.interpolationValue.dispose(),this.interpolationName=null,this.interpolationValue=null,this.node=null,this.name=null,this.value=null,this.previousName=null},update:function(){this.node.repeater||(this.interpolationName.update(),this.interpolationValue.update())},render:function(){function e(e,t,n){"value"===e&&void 0!==n.element.value?r.value=t:7===Ee&&"class"===e?r.className=t:r.setAttribute(e,t)}function t(e,t){l(e)?r.setAttribute(t,t):r.removeAttribute(t)}function n(e){r.setAttribute("src",e)}function i(e){r.setAttribute("href",e)}if(!this.node.repeater){var r=this.node.element;if(this.invalidate&&(this.invalidate=!1,this.previousName=this.name,this.name=o(this.interpolationName.render())?this.interpolationName.render():this.name,this.value=o(this.interpolationValue.render())?this.interpolationValue.render():this.value,this.name===ce.src?n(this.value):this.name===ce.href?i(this.value):((7!==Ee||7===Ee&&!this.node.isRepeaterChild)&&this.node.element.removeAttribute(this.interpolationName.value),this.previousName&&(7===Ee&&"class"===this.previousName?this.node.element.className="":(7!==Ee||7===Ee&&!this.node.isRepeaterChild)&&this.node.element.removeAttribute(this.previousName)),e(this.name,this.value,this.node))),this.name===ce["class"]){var a,s,u,h,p;try{a=JSON.parse(this.value)}catch(c){throw new Error("Error, the value of a data-class attribute must be a valid JSON: "+this.value)}for(s in a)u=a[s],p=u?l(u):!1,h=u?l(u):!1,p?this.node.element.classList.add(s):w(this.node.element,s)}if("class"===this.name&&-1!==this.value.indexOf(he.attributes.cloak)&&w(this.node.element,he.attributes.cloak),this.name===ce.hide){var d=l(this.value);e(this.name,d,this.node),r.style.display=d?"none":""}if(this.name===ce.show){var d=l(this.value);e(this.name,d,this.node),r.style.display=d?"":"none"}if(this.name===ce.checked&&(t(this.value,"checked"),e(this.name,l(this.value)?!0:!1,this.node),r.checked=l(this.value)?!0:!1),this.name===ce.disabled&&(t(this.value,"disabled"),e(this.name,l(this.value)?!0:!1,this.node)),this.name===ce.multiple&&(t(this.value,"multiple"),e(this.name,l(this.value)?!0:!1,this.node)),this.name===ce.readonly){var d=l(this.value);7===Ee?r.readOnly=d?!0:!1:t(this.value,"readonly"),e(this.name,d?!0:!1,this.node)}this.name===ce.selected&&(t(this.value,"selected"),e(this.name,l(this.value)?!0:!1,this.node))}}};var Se=function(e,t,n){this.value=t&&!a(t.element)?f(e):e,this.node=t,this.attribute=n,this.sequence=[],this.expressions=[];var i=this.value.match(ye.sequence);if(i){for(var r=0,s=i.length;s>r;r++)if(i[r].match(ye.token)){var o=new ke(g(i[r]),this.node,this.attribute);this.sequence.push(o),this.expressions.push(o)}else this.sequence.push(i[r]);m(this.sequence)}};Se.prototype={toString:function(){return"[object Interpolation]"},dispose:function(){if(this.expressions)for(var e=0,t=this.expressions.length;t>e;e++)this.expressions[e].dispose();this.value=null,this.node=null,this.attribute=null,this.sequence=null,this.expressions=null},update:function(){for(var e=-1,t=this.expressions.length;++e<t;)this.expressions[e].update()},render:function(){var e="";if(this.sequence)for(var t=0,n=this.sequence.length;n>t;t++){var i="";i=u(this.sequence[t])?this.sequence[t].value:this.sequence[t],o(i)||(i=""),e+=i}return e}};var ke=function(e,t,n){o(e)&&(this.pattern=e,this.isString=ye.string.test(e),this.node=t,this.attribute=n,this.value=this.isString?this.pattern:void 0,this.isString?(this.isFunction=!1,this.depth=null,this.path=null,this.params=null):(this.isFunction=h(this.pattern),this.depth=C(this.pattern),this.path=_(this.pattern),this.params=this.isFunction?A(this.pattern.match(ye.func)[2]):null))};ke.prototype={toString:function(){return"[object Expression]"},dispose:function(){this.pattern=null,this.node=null,this.attribute=null,this.path=null,this.params=null,this.value=null},update:function(){var e=this.node;if(!e&&this.attribute&&(e=this.attribute.node),e||!e.scope){var t=this.getValue(e.scope);t=S(this,t),this.value!==t&&(this.value=t,(this.node||this.attribute).invalidate=!0)}},getValue:function(e,t,n){var i=this.node;!i&&this.attribute&&(i=this.attribute.node);var r={};return i&&(r[de.element]=i.element,i.element&&(r[de.parentElement]=i.element.parentNode)),r[de.attribute]=this.attribute,r[de.scope]=e,$(e,this.pattern,this.path,this.params,t,n,void 0,r)}};var Te=new N("st"),$e=function(e){this.watchers=new N("stw"),this.node=null,this.scope=null,this.compile(e)};$e.prototype={toString:function(){return"[object Template]"},compile:function(e){e&&(this.element=e),this.node&&this.node.dispose(),this.node=q(this,this.element),this.node.root=!0,this.scope=this.node.scope},update:function(e){o(e)&&M(this.node.scope,e),this.node&&this.node.update()},render:function(e){this.update(e),this.node&&this.node.render()},invalidate:function(){this.node&&this.node.invalidateData()},watch:function(e,t){(i(e)||r(e))&&s(t)&&this.watchers.put(e,t)},unwatch:function(e){this.watchers.remove(e)},clearWatchers:function(){this.watchers.dispose()},clearEvents:function(){this.node.clearEvents()},getNode:function(e){return this.node.getNode(e)},dispose:function(){Te.remove(this.element),this.watchers&&this.watchers.dispose(),this.node&&this.node.dispose(),this.element=null,this.watchers=null,this.node=null}},z.guid=1,X.preventDefault=function(){this.returnValue=!1},X.stopPropagation=function(){this.cancelBubble=!0};var _e,Ae,Ce=[];if("object"==typeof document){var Ae=function(){function e(e){for(p=1;e=n.shift();)e()}var t,n=[],i=!1,r=document,a=r.documentElement,s=a.doScroll,o="DOMContentLoaded",l="addEventListener",u="onreadystatechange",h="readyState",p=/^loade|c/.test(r[h]);return r[l]&&r[l](o,t=function(){r.removeEventListener(o,t,i),e()},i),s&&r.attachEvent(u,t=function(){/^c/.test(r[h])&&(r.detachEvent(u,t),e())}),s?function(e){self!=top?p?e():n.push(e):function(){try{a.doScroll("left")}catch(t){return setTimeout(function(){Ae(e)},50)}e()}()}:function(e){p?e():n.push(e)}}();if(he.autocreate){var Le=function(t){for(var n=t?t.firstChild:document.body;n;){if(1===n.nodeType){Le(n);var i=n.getAttribute(ce.template);if(i){var r=new Function("return "+i+";"),a=r();s(a)&&e.template.bootstrap(i,n,a)}}n=n.nextSibling}};Ae(Le)}}pe.start(se),pe.end(oe),e.plugins=e.plugins||{};var Pe=function(t,n){t.constructor.prototype.createTemplate=function(t,i){if(!t||"function"!=typeof t)throw new Error("Error creating a template, the first parameter must be a function.");if(i&&r(i)){var a=e.template.create(i);for(var s in a)"function"==typeof a[s]&&(t.prototype[s]=a[s].bind(a));t.prototype.render=a.render.bind(a);var o=n.createChild();return o.mapValue("template",a),o.mapValue("scope",a.scope),o.mapValue("element",a.element),o.createInstance(t)}return null},e.template.bootstrap=function(e,n,i){t.createTemplate(i,n)}};e.plugins&&e.plugins.add&&e.plugins.add(Pe),e.template.Plugin=Pe,e.template.create=ne,e.template.get=ie,e.template.renderAll=re,e.template.helpers=ae,e.template.bootstrap=te,e.template.addEvent=z,e.template.removeEvent=U,e.template.parseEvents=K,e.template.clearEvents=ee,e.template.ready=Ae,"function"==typeof define&&"undefined"!=typeof define.amd&&define("soma-template",e.template),"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=e.template),"undefined"!=typeof exports&&(exports=e.template)}(this.soma=this.soma||{});